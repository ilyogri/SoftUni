--CREATE DATABASE TheNerdHerd

CREATE TABLE Credentials(
Id INT PRIMARY KEY IDENTITY,
Email VARCHAR(30),
Password VARCHAR(20)
)

CREATE TABLE Locations(
Id INT PRIMARY KEY IDENTITY,
Latitude FLOAT,
Longitude FLOAT);

CREATE TABLE Users(
Id INT PRIMARY KEY IDENTITY,
Nickname VARCHAR(25),
Gender CHAR(1),
Age INT,
LocationId INT,
CredentialId INT,
CONSTRAINT FK_Users_Locations FOREIGN KEY(LocationId) REFERENCES Locations(Id),
CONSTRAINT FK_Users_Credentials FOREIGN KEY(CredentialId) REFERENCES Credentials(Id),
CONSTRAINT uk_CredentialId UNIQUE(CredentialId)
)

CREATE TABLE Chats(
Id INT PRIMARY KEY IDENTITY,
Title VARCHAR(32),
StartDate DATE,
IsActive BIT
)

CREATE TABLE UsersChats(
UserId INT,
ChatId INT,
CONSTRAINT PK_ChatId_UserId PRIMARY KEY(ChatId, UserId),
CONSTRAINT FK_UsersChats_Users FOREIGN KEY(UserId) REFERENCES Users(Id),
CONSTRAINT FK_UsersChats_Chats FOREIGN KEY(ChatId) REFERENCES Chats(Id)
)

CREATE TABLE Messages(
Id INT PRIMARY KEY IDENTITY,
Content VARCHAR(200),
SentOn DATE,
ChatId INT,
UserId INT,
CONSTRAINT FK_Messages_Chats FOREIGN KEY(ChatId) REFERENCES Chats(Id),
CONSTRAINT FK_Messages_Users FOREIGN KEY(UserId) REFERENCES Users(Id)
)